# 모의 컨설팅 과제

---

GitHub repository 

[https://github.com/JoWoonJi/Pentest](https://github.com/JoWoonJi/Pentest)

링크 [JoWoonJi/Pentest: Simulation consulting,Mock hacking,Vulnerability assessment (github.com)](https://github.com/JoWoonJi/Pentest)

---

모의해킹 공격 구상

- [x]  오픈 소스 모의 해킹 사이트 취약점 분석해보기 // 로그인,검색창,피드백submit
- [x]  로그인 폼에 SQL Injection
- [x]  검색창에 XSS 공격
- [ ]  피드백 폼에 파일 업로드 공격, CSRF 공격 실패 // 게시판이나 업로드 공간이 있었다면 파일 업로드 공격이나 웹쉘을 이용한 공격이 좀 더 용이 했을듯

---

# Vulnerability 1. SQL Injection

- 1-1. 로그인 폼에 SQL Injection의 대표적 구문인 ‘ or ‘1’=’1 을 테스트 해 본다. admin 계정이 있을 것으로 추측.

![글쓰기 구현 - 글등록 성공시.jpg](%E1%84%86%E1%85%A9%E1%84%8B%E1%85%B4%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%89%E1%85%A5%E1%86%AF%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/%25EA%25B8%2580%25EC%2593%25B0%25EA%25B8%25B0_%25EA%25B5%25AC%25ED%2598%2584_-_%25EA%25B8%2580%25EB%2593%25B1%25EB%25A1%259D_%25EC%2584%25B1%25EA%25B3%25B5%25EC%258B%259C.jpg)

---

- 1-2. admin 계정 탈취 성공. 이처럼 SQL Injection은 간단하지만 피해는 상상할 수 없을 정도로 큼.

![게시글 목록출력,글쓰기 버튼 클릭.jpg](%E1%84%86%E1%85%A9%E1%84%8B%E1%85%B4%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%89%E1%85%A5%E1%86%AF%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/%25EA%25B2%258C%25EC%258B%259C%25EA%25B8%2580_%25EB%25AA%25A9%25EB%25A1%259D%25EC%25B6%259C%25EB%25A0%25A5%25EA%25B8%2580%25EC%2593%25B0%25EA%25B8%25B0_%25EB%25B2%2584%25ED%258A%25BC_%25ED%2581%25B4%25EB%25A6%25AD.jpg)

---

- 1-3. admin 계정 탈취 시 해당 사이트 피해 가능성. 아래 사진처럼 다른 계좌로 송금이 가능함. 막대한 금전적 손실.

![DB 연결,저장 구현.jpg](%E1%84%86%E1%85%A9%E1%84%8B%E1%85%B4%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%89%E1%85%A5%E1%86%AF%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/DB_%25EC%2597%25B0%25EA%25B2%25B0%25EC%25A0%2580%25EC%259E%25A5_%25EA%25B5%25AC%25ED%2598%2584.jpg)

---

- 1-4 . 기타 피해 사례. 아래 사진처럼 다른 계정의 비밀번호도 바꿀 수 있으며, 새로운 계정을 임의로 추가 할 수도 있음.

![게시글 클릭시- 글읽기 구현 -조회수 기능.jpg](%E1%84%86%E1%85%A9%E1%84%8B%E1%85%B4%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%89%E1%85%A5%E1%86%AF%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/%25EA%25B2%258C%25EC%258B%259C%25EA%25B8%2580_%25ED%2581%25B4%25EB%25A6%25AD%25EC%258B%259C-_%25EA%25B8%2580%25EC%259D%25BD%25EA%25B8%25B0_%25EA%25B5%25AC%25ED%2598%2584_-%25EC%25A1%25B0%25ED%259A%258C%25EC%2588%2598_%25EA%25B8%25B0%25EB%258A%25A5.jpg)

---

# 대응 방안

<aside>
💡 SQL Injection 공격은 웹 애플리케이션의 입력 데이터를 검증하지 않거나, 출력 값을 보안 처리하지 않음으로써 발생한다.

아주 간단한 공격이지만 피해는 상상할 수 없으므로 로그인 페이지에 보안 코딩을 적용해야 한다. 미리 바인딩 시키거나 pstmt(prepared statement)를 활용해 인젝션등을 원천 차단해야 한다.

필터링을 한다면 ', ", ;, /, \, *, ?, %, &, |, ^, ~ 등과 같은 특수문자를 반드시 제한해야한다.

SQL 인코딩을 하고, 인젝션이 가능한 폼에는 재검증하여 반드시 주의해야 한다.

출력값을 SQL 구문에 직접 삽입하지 않도록 해야 SQL Injection 공격을 차단할 수 있다.

</aside>

---

---

---

---

# Vulnerability 2. Cross-Site Scripting(XSS)

- 2-1. 검색창에 xss 취약점이 있는지 스크립트 구문으로 테스트해 본다.

![1.SQL Injection test admin 입력하고 로그인해 보기.jpg](%E1%84%86%E1%85%A9%E1%84%8B%E1%85%B4%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%89%E1%85%A5%E1%86%AF%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/1.SQL_Injection_test_admin_%25EC%259E%2585%25EB%25A0%25A5%25ED%2595%2598%25EA%25B3%25A0_%25EB%25A1%259C%25EA%25B7%25B8%25EC%259D%25B8%25ED%2595%25B4_%25EB%25B3%25B4%25EA%25B8%25B0.jpg)

---

- 2-2. 공격자가 입력한 alert 스크립트가 정상적으로 실행된 것이 확인된다.

![2.bool이 뜨며 로그인이 되지 않는다.jpg](%E1%84%86%E1%85%A9%E1%84%8B%E1%85%B4%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%89%E1%85%A5%E1%86%AF%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/2.bool%25EC%259D%25B4_%25EB%259C%25A8%25EB%25A9%25B0_%25EB%25A1%259C%25EA%25B7%25B8%25EC%259D%25B8%25EC%259D%25B4_%25EB%2590%2598%25EC%25A7%2580_%25EC%2595%258A%25EB%258A%2594%25EB%258B%25A4.jpg)

---

- 2-3. 이처럼 xss 공격이 가능하면 아래 사진의 왼쪽 상단 처럼 board title도 바꿀 수 있고, img src를 활용해 이미지를 삽입하거나 embed 를 활용해 공격자가 원하는 url도 삽입가능하다. 세션 이나 쿠키를 탈취 당하여 막대한 피해를 입을 것으로 예상된다.

![3.SQL injection의 대표적인 구문으로 관리자 계정을 탈취해보자.jpg](%E1%84%86%E1%85%A9%E1%84%8B%E1%85%B4%20%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%89%E1%85%A5%E1%86%AF%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/3.SQL_injection%25EC%259D%2598_%25EB%258C%2580%25ED%2591%259C%25EC%25A0%2581%25EC%259D%25B8_%25EA%25B5%25AC%25EB%25AC%25B8%25EC%259C%25BC%25EB%25A1%259C_%25EA%25B4%2580%25EB%25A6%25AC%25EC%259E%2590_%25EA%25B3%2584%25EC%25A0%2595%25EC%259D%2584_%25ED%2583%2588%25EC%25B7%25A8%25ED%2595%25B4%25EB%25B3%25B4%25EC%259E%2590.jpg)

---

# 대응 방안

<aside>
💡 XSS(Cross-Site Scripting)는 웹 애플리케이션의 취약점을 이용하여 악성 스크립트를 사용자의 브라우저에 실행시키는 공격이다.  XSS 공격을 통해 공격자는 사용자의 개인 정보 탈취, 웹사이트의 권한 획득, 악성 코드 유포 등의 피해를 입힐 수 있다.

XSS를 방어하기 위해서는 데이터를 입력할 때와 출력할 때, 모두 필터링하고, 클라이언트에도 막을 수 있을만한 수단을 구성해 놓는 것이 좋다.

필터링을 제작해서 사용할 때는 라이브러리를 활용할 수 있다.

xss 방어를 위한 예시

- **사용자 입력 검증**
- `특수 문자 제한: <, >, ', ", /, \ 등과 같은 특수 문자를 제한
* HTML 인코딩: 특수 문자를 HTML 인코딩하여 악성 스크립트로 인식되지 않도록
* 스크립트 태그 제거: <script>, </script> 태그를 제거`
- **출력 값 보안 처리**
- `HTML 인코딩
* 스크립트 태그 제거: 출력 값에서 <script>, </script> 태그를 제거.`
- **웹 애플리케이션 보안 강화**
- `취약점 스캐너 사용: 웹 애플리케이션의 취약점을 자동으로 검사하는 도구를 사용
* 코드 검토: 웹 애플리케이션의 코드를 사람이 직접 검토`

</aside>